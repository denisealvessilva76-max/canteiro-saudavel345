<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel Admin - Canteiro Saud√°vel</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{--primary:#FF6B35;--primary-dark:#E55A2B;--success:#22C55E;--warning:#F59E0B;--danger:#EF4444;--info:#3B82F6;--bg:#F4F6F9;--surface:#FFF;--text:#1F2937;--text-light:#6B7280;--border:#E5E7EB;}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);}
.hidden{display:none!important;}

/* Login */
#login-screen{min-height:100vh;background:linear-gradient(135deg,var(--primary),var(--primary-dark));display:flex;align-items:center;justify-content:center;padding:2rem;}
.login-box{background:#fff;border-radius:24px;padding:2.5rem;max-width:400px;width:100%;box-shadow:0 20px 60px rgba(0,0,0,.3);}
.logo-admin{width:80px;height:80px;background:var(--primary);border-radius:20px;display:flex;align-items:center;justify-content:center;font-size:2rem;margin:0 auto 1.5rem;}
.login-title{font-size:1.75rem;font-weight:800;text-align:center;margin-bottom:.5rem;}
.login-sub{color:var(--text-light);font-size:.875rem;text-align:center;margin-bottom:2rem;}
.form-group{margin-bottom:1.25rem;}
.form-label{display:block;font-weight:600;margin-bottom:.5rem;font-size:.875rem;}
.form-input{width:100%;padding:.85rem;border:2px solid var(--border);border-radius:10px;font-size:.95rem;font-family:inherit;}
.form-input:focus{outline:none;border-color:var(--primary);}
.btn{width:100%;padding:1rem;border:none;border-radius:10px;font-weight:700;cursor:pointer;font-family:inherit;font-size:1rem;}
.btn-primary{background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:#fff;}
.alert{padding:.85rem;border-radius:8px;margin-bottom:1rem;font-size:.875rem;display:none;}
.alert-error{background:#FEE2E2;color:#991B1B;}
.alert.show{display:block;}

/* Dashboard */
#dashboard{display:none;}
#dashboard.active{display:block;}
.top-bar{background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:#fff;padding:1.5rem 2rem;display:flex;justify-content:space-between;align-items:center;}
.top-bar h1{font-size:1.5rem;font-weight:800;}
.user-info{font-size:.875rem;opacity:.9;margin-top:.25rem;}
.btn-logout{background:rgba(255,255,255,.2);border:none;color:#fff;padding:.5rem 1rem;border-radius:8px;cursor:pointer;font-weight:600;}
.container{max-width:1400px;margin:0 auto;padding:2rem;}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem;margin-bottom:2rem;}
.stat-card{background:#fff;border-radius:16px;padding:1.5rem;box-shadow:0 2px 10px rgba(0,0,0,.08);}
.stat-icon{width:50px;height:50px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.5rem;margin-bottom:1rem;}
.stat-label{font-size:.875rem;color:var(--text-light);margin-bottom:.25rem;}
.stat-value{font-size:2rem;font-weight:800;color:var(--text);}
.tabs{display:flex;gap:1rem;margin-bottom:2rem;border-bottom:2px solid var(--border);}
.tab{padding:1rem 1.5rem;border:none;background:transparent;cursor:pointer;font-weight:600;color:var(--text-light);border-bottom:2px solid transparent;margin-bottom:-2px;font-family:inherit;}
.tab.active{color:var(--primary);border-bottom-color:var(--primary);}
.panel{display:none;background:#fff;border-radius:16px;padding:2rem;box-shadow:0 2px 10px rgba(0,0,0,.08);}
.panel.active{display:block;}
table{width:100%;border-collapse:collapse;}
th,td{padding:1rem;text-align:left;border-bottom:1px solid var(--border);}
th{font-weight:700;background:var(--bg);font-size:.875rem;color:var(--text-light);}
.btn-sm{padding:.5rem 1rem;font-size:.875rem;border-radius:8px;border:none;cursor:pointer;font-weight:600;font-family:inherit;}
.btn-edit{background:var(--info);color:#fff;}
.btn-delete{background:var(--danger);color:#fff;}
.btn-add{background:var(--success);color:#fff;margin-bottom:1.5rem;}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:1000;align-items:center;justify-content:center;}
.modal.show{display:flex;}
.modal-content{background:#fff;border-radius:20px;padding:2rem;max-width:500px;width:90%;max-height:80vh;overflow-y:auto;}
.modal-header{font-size:1.25rem;font-weight:800;margin-bottom:1.5rem;}
.alert-item{background:#fff;border-left:4px solid var(--danger);padding:1rem;margin-bottom:1rem;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.05);}
.alert-title{font-weight:700;margin-bottom:.25rem;}
.alert-meta{font-size:.75rem;color:var(--text-light);}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login-screen">
<div class="login-box">
  <div class="logo-admin">üë®‚Äçüíº</div>
  <div class="login-title">Painel Administrativo</div>
  <div class="login-sub">Canteiro Saud√°vel - Obra 345</div>
  <div class="alert alert-error" id="login-error"></div>
  <form onsubmit="login(event)">
    <div class="form-group">
      <label class="form-label">Email Corporativo</label>
      <input type="email" class="form-input" id="admin-email" placeholder="seu-email@mip.com.br" required>
    </div>
    <div class="form-group">
      <label class="form-label">Senha</label>
      <input type="password" class="form-input" id="admin-password" required>
    </div>
    <button type="submit" class="btn btn-primary">Entrar no Painel</button>
  </form>
</div>
</div>

<!-- DASHBOARD -->
<div id="dashboard">
  <div class="top-bar">
    <div>
      <h1>üìä Painel Administrativo - SESMT</h1>
      <div class="user-info" id="admin-user-email"></div>
    </div>
    <button class="btn-logout" onclick="logout()">Sair</button>
  </div>

  <div class="container">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon" style="background:rgba(59,130,246,.1);color:var(--info);">üë•</div>
        <div class="stat-label">Total Empregados</div>
        <div class="stat-value" id="stat-users">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon" style="background:rgba(34,197,94,.1);color:var(--success);">‚úÖ</div>
        <div class="stat-label">Check-ins Hoje</div>
        <div class="stat-value" id="stat-checkins">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon" style="background:rgba(245,158,11,.1);color:var(--warning);">üî•</div>
        <div class="stat-label">Sequ√™ncia M√©dia</div>
        <div class="stat-value" id="stat-streak">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon" style="background:rgba(255,107,53,.1);color:var(--primary);">üèÜ</div>
        <div class="stat-label">Pontos Totais</div>
        <div class="stat-value" id="stat-points">0</div>
      </div>
    </div>

    <div class="tabs">
      <button class="tab active" onclick="switchTab('overview')">üìä Vis√£o Geral</button>
      <button class="tab" onclick="switchTab('users')">üë• Empregados</button>
      <button class="tab" onclick="switchTab('rewards')">üéÅ Brindes</button>
      <button class="tab" onclick="switchTab('news')">üì∞ Not√≠cias</button>
      <button class="tab" onclick="switchTab('alerts')">üö® Alertas</button>
    </div>

    <div class="panel active" id="panel-overview">
      <h2 style="margin-bottom:1.5rem;">üìà Estat√≠sticas Gerais</h2>
      <div id="overview-content"><p style="color:var(--text-light);">Carregando dados...</p></div>
    </div>

    <div class="panel" id="panel-users">
      <h2 style="margin-bottom:1.5rem;">üë• Lista de Empregados</h2>
      <div id="users-table"></div>
    </div>

    <div class="panel" id="panel-rewards">
      <h2 style="margin-bottom:1.5rem;">üéÅ Gerenciar Recompensas</h2>
      <button class="btn btn-add btn-sm" onclick="openAddReward()">+ Adicionar Brinde</button>
      <div id="rewards-table"></div>
    </div>

    <div class="panel" id="panel-news">
      <h2 style="margin-bottom:1.5rem;">üì∞ Mural de Not√≠cias</h2>
      <button class="btn btn-add btn-sm" onclick="openAddNews()">+ Publicar Not√≠cia</button>
      <div id="news-list"></div>
    </div>

    <div class="panel" id="panel-alerts">
      <h2 style="margin-bottom:1.5rem;">üö® Alertas do SESMT</h2>
      <div id="alerts-list"></div>
    </div>
  </div>
</div>

<!-- Modal Add Reward -->
<div class="modal" id="modal-reward">
<div class="modal-content">
  <div class="modal-header">üéÅ Adicionar Recompensa</div>
  <div class="form-group"><label class="form-label">Nome do Brinde</label><input type="text" class="form-input" id="reward-name"></div>
  <div class="form-group"><label class="form-label">Pontos Necess√°rios</label><input type="number" class="form-input" id="reward-points"></div>
  <div class="form-group"><label class="form-label">Estoque</label><input type="number" class="form-input" id="reward-stock"></div>
  <div class="form-group">
    <label class="form-label">Categoria</label>
    <select class="form-input" id="reward-category">
      <option value="reconhecimento">Reconhecimento</option>
      <option value="brindes">Brindes</option>
    </select>
  </div>
  <div style="display:flex;gap:1rem;margin-top:1.5rem;">
    <button class="btn btn-sm" style="flex:1;background:var(--text-light);color:#fff;" onclick="closeModal('modal-reward')">Cancelar</button>
    <button class="btn btn-sm btn-add" style="flex:1;" onclick="saveReward()">Salvar</button>
  </div>
</div>
</div>

<!-- Modal Add News -->
<div class="modal" id="modal-news">
<div class="modal-content">
  <div class="modal-header">üì∞ Publicar Not√≠cia</div>
  <div class="form-group"><label class="form-label">T√≠tulo</label><input type="text" class="form-input" id="news-title"></div>
  <div class="form-group"><label class="form-label">Conte√∫do</label><textarea class="form-input" id="news-content" rows="5"></textarea></div>
  <div style="display:flex;gap:1rem;margin-top:1.5rem;">
    <button class="btn btn-sm" style="flex:1;background:var(--text-light);color:#fff;" onclick="closeModal('modal-news')">Cancelar</button>
    <button class="btn btn-sm btn-add" style="flex:1;" onclick="saveNews()">Publicar</button>
  </div>
</div>
</div>

<script>
// ============================================================
// AUTENTICA√á√ÉO COM 2 EMAILS AUTORIZADOS
// ============================================================
const ADMIN_USERS = [
  { email: 'denise.silva@mip.com.br', password: 'Sesmt@345!', name: 'Denise Alves da Silva' },
  { email: 'estefane.mendes@mip.com.br', password: 'Sesmt@345!', name: 'Estefane Mendes' }
];

function login(e) {
  e.preventDefault();
  const email = document.getElementById('admin-email').value.trim().toLowerCase();
  const password = document.getElementById('admin-password').value;
  
  const user = ADMIN_USERS.find(u => u.email === email && u.password === password);
  
  if (user) {
    localStorage.setItem('admin_logged', 'true');
    localStorage.setItem('admin_email', user.email);
    localStorage.setItem('admin_name', user.name);
    showDashboard();
  } else {
    const err = document.getElementById('login-error');
    err.textContent = '‚ùå Email ou senha incorretos! Acesso permitido apenas para funcion√°rios do SESMT.';
    err.classList.add('show');
  }
}

function logout() {
  if (confirm('Deseja sair do painel admin?')) {
    localStorage.removeItem('admin_logged');
    localStorage.removeItem('admin_email');
    localStorage.removeItem('admin_name');
    location.reload();
  }
}

function showDashboard() {
  document.getElementById('login-screen').classList.add('hidden');
  document.getElementById('dashboard').classList.add('active');
  const adminEmail = localStorage.getItem('admin_email');
  const adminName = localStorage.getItem('admin_name');
  document.getElementById('admin-user-email').textContent = `${adminName} (${adminEmail})`;
  loadData();
}

if (localStorage.getItem('admin_logged') === 'true') {
  showDashboard();
}

// ============================================================
// RESTO DO C√ìDIGO (igual ao anterior)
// ============================================================
function switchTab(tab) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  event.target.classList.add('active');
  document.getElementById('panel-' + tab).classList.add('active');
}

function loadData() {
  loadStats();
  loadUsers();
  loadRewards();
  loadNews();
  loadAlerts();
}

function loadStats() {
  const users = JSON.parse(localStorage.getItem('cs_users') || '[]');
  const hoje = new Date().toDateString();
  let totalCheckins = 0, totalPoints = 0, streaks = [];
  users.forEach(u => {
    totalPoints += (u.pontos || 0);
    const checkins = JSON.parse(localStorage.getItem(`cs_checkins_${u.matricula}`) || '[]');
    totalCheckins += checkins.filter(c => new Date(c.data).toDateString() === hoje).length;
    streaks.push(calcStreak(checkins));
  });
  const avgStreak = streaks.length ? Math.round(streaks.reduce((a,b)=>a+b,0) / streaks.length) : 0;
  document.getElementById('stat-users').textContent = users.length;
  document.getElementById('stat-checkins').textContent = totalCheckins;
  document.getElementById('stat-streak').textContent = avgStreak;
  document.getElementById('stat-points').textContent = totalPoints.toLocaleString('pt-BR');
}

function calcStreak(checkins) {
  if (!checkins.length) return 0;
  let seq = 0, curr = new Date(); curr.setHours(0,0,0,0);
  for (let i = 0; i < 30; i++) {
    if (checkins.find(c => new Date(c.data).toDateString() === curr.toDateString())) seq++;
    else break;
    curr.setDate(curr.getDate() - 1);
  }
  return seq;
}

function loadUsers() {
  const users = JSON.parse(localStorage.getItem('cs_users') || '[]');
  const html = `<table><thead><tr><th>Nome</th><th>Matr√≠cula</th><th>Fun√ß√£o</th><th>Turno</th><th>Pontos</th></tr></thead><tbody>${users.map(u => `<tr><td>${u.nome}</td><td>${u.matricula}</td><td>${u.funcao}</td><td>${u.turno==='matutino'?'Matutino':'Noturno'}</td><td><strong>${u.pontos||0}</strong></td></tr>`).join('')}</tbody></table>`;
  document.getElementById('users-table').innerHTML = html || '<p>Nenhum empregado cadastrado.</p>';
}

function loadRewards() {
  const rewards = JSON.parse(localStorage.getItem('cs_rewards') || '[]');
  if (!rewards.length) {
    const defaults = [{id:1,nome:'Certificado Digital',pontos:100,estoque:'Ilimitado',categoria:'reconhecimento'},{id:2,nome:'Bon√© 65 MIP',pontos:600,estoque:20,categoria:'brindes'},{id:3,nome:'Garrafa T√©rmica',pontos:800,estoque:15,categoria:'brindes'}];
    localStorage.setItem('cs_rewards', JSON.stringify(defaults));
  }
  const list = JSON.parse(localStorage.getItem('cs_rewards') || '[]');
  const html = `<table><thead><tr><th>Nome</th><th>Pontos</th><th>Estoque</th><th>Categoria</th><th>A√ß√µes</th></tr></thead><tbody>${list.map(r => `<tr><td>${r.nome}</td><td>${r.pontos}</td><td>${r.estoque}</td><td>${r.categoria}</td><td><button class="btn-sm btn-edit" onclick="editReward(${r.id})">Editar</button> <button class="btn-sm btn-delete" onclick="deleteReward(${r.id})">Deletar</button></td></tr>`).join('')}</tbody></table>`;
  document.getElementById('rewards-table').innerHTML = html;
}

function openAddReward() {
  document.getElementById('modal-reward').classList.add('show');
  document.getElementById('reward-name').value = '';
  document.getElementById('reward-points').value = '';
  document.getElementById('reward-stock').value = '';
}

function saveReward() {
  const nome = document.getElementById('reward-name').value;
  const pontos = parseInt(document.getElementById('reward-points').value);
  const estoque = document.getElementById('reward-stock').value;
  const categoria = document.getElementById('reward-category').value;
  if (!nome || !pontos) { alert('Preencha todos os campos!'); return; }
  const rewards = JSON.parse(localStorage.getItem('cs_rewards') || '[]');
  rewards.push({id: Date.now(),nome,pontos,estoque,categoria});
  localStorage.setItem('cs_rewards', JSON.stringify(rewards));
  closeModal('modal-reward');
  loadRewards();
  alert('‚úÖ Recompensa adicionada!');
}

function deleteReward(id) {
  if (!confirm('Deletar esta recompensa?')) return;
  let rewards = JSON.parse(localStorage.getItem('cs_rewards') || '[]');
  rewards = rewards.filter(r => r.id !== id);
  localStorage.setItem('cs_rewards', JSON.stringify(rewards));
  loadRewards();
}

function loadNews() {
  const news = JSON.parse(localStorage.getItem('cs_news') || '[]');
  const html = news.length ? news.map(n => `<div class="alert-item" style="border-left-color:var(--info);"><div class="alert-title">${n.titulo}</div><div style="margin:.5rem 0;font-size:.875rem;">${n.conteudo}</div><div class="alert-meta">${new Date(n.data).toLocaleDateString('pt-BR')} ‚Ä¢ Por ${n.autor}</div></div>`).join('') : '<p style="color:var(--text-light);">Nenhuma not√≠cia publicada.</p>';
  document.getElementById('news-list').innerHTML = html;
}

function openAddNews() {
  document.getElementById('modal-news').classList.add('show');
  document.getElementById('news-title').value = '';
  document.getElementById('news-content').value = '';
}

function saveNews() {
  const titulo = document.getElementById('news-title').value;
  const conteudo = document.getElementById('news-content').value;
  if (!titulo || !conteudo) { alert('Preencha todos os campos!'); return; }
  const news = JSON.parse(localStorage.getItem('cs_news') || '[]');
  news.unshift({id: Date.now(),titulo,conteudo,data: new Date().toISOString(),autor: localStorage.getItem('admin_name') || 'SESMT'});
  localStorage.setItem('cs_news', JSON.stringify(news));
  closeModal('modal-news');
  loadNews();
  alert('‚úÖ Not√≠cia publicada!');
}

function loadAlerts() {
  const alertas = JSON.parse(localStorage.getItem('cs_alertas') || '[]');
  const html = alertas.length ? alertas.reverse().slice(0,10).map(a => `<div class="alert-item"><div class="alert-title">${a.tipo.replace(/_/g,' ').toUpperCase()}</div><div style="margin:.5rem 0;font-size:.875rem;">${a.mensagem}</div><div class="alert-meta">${new Date(a.data).toLocaleString('pt-BR')}</div></div>`).join('') : '<p style="color:var(--text-light);">Nenhum alerta no momento.</p>';
  document.getElementById('alerts-list').innerHTML = html;
}

function closeModal(id) { document.getElementById(id).classList.remove('show'); }
window.addEventListener('click', e => { if (e.target.classList.contains('modal')) e.target.classList.remove('show'); });

console.log('üöÄ Painel Admin Canteiro Saud√°vel v2.0 - 2 usu√°rios autorizados');
</script>
</body>
</html>
